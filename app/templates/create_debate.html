{% extends "base.html" %}

{% block title %}ç™¼èµ·æ–°è¾¯è«– - æ‡‚äº‹è«–å£‡{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- é é¢æ¨™é¡Œ -->
            <div class="text-center mb-5">
                <div class="hero-icon mb-3">
                    <i class="fas fa-lightbulb text-warning" style="font-size: 3rem;"></i>
                </div>
                <h1 class="display-5 fw-bold text-primary">ç™¼èµ·æ–°è¾¯è«–</h1>
                <p class="lead text-muted">åˆ†äº«ä½ çš„è§€é»ï¼Œé‚€è«‹ä»–äººåƒèˆ‡ç†æ€§è¨è«–</p>
            </div>

            <!-- è¾¯è«–è¡¨å–® -->
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0"><i class="fas fa-edit me-2"></i>è¾¯è«–è©³æƒ…</h4>
                </div>
                <div class="card-body p-4">
                    <form method="POST" action="{{ url_for('main.create_debate') }}" id="debateForm">
                        <!-- è¾¯è«–ä¸»é¡Œ -->
                        <div class="mb-4">
                            <label for="debateTitle" class="form-label fw-bold">
                                è¾¯è«–ä¸»é¡Œ <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control form-control-lg" 
                                   id="debateTitle" name="title" 
                                   placeholder="ä¾‹ï¼šAIäººå·¥æ™ºæ…§æ˜¯å¦æœƒé€ æˆå¤§è¦æ¨¡å¤±æ¥­ï¼Ÿ" 
                                   required maxlength="200">
                            <div class="form-text">
                                <i class="fas fa-info-circle text-primary"></i>
                                å»ºè­°ä½¿ç”¨å•å¥å½¢å¼ï¼Œè®“è­°é¡Œæ›´æ˜ç¢ºä¸”å®¹æ˜“è¨è«–
                            </div>
                            <div class="character-count mt-1">
                                <small class="text-muted">
                                    <span id="titleCount">0</span>/200 å­—
                                </small>
                            </div>
                        </div>
                        
                        <!-- è­°é¡Œèªªæ˜ -->
                        <div class="mb-4">
                            <label for="debateDescription" class="form-label fw-bold">è­°é¡Œèªªæ˜</label>
                            <textarea class="form-control" id="debateDescription" 
                                      name="description" rows="5" maxlength="1000"
                                      placeholder="è©³ç´°èªªæ˜è¾¯è«–çš„èƒŒæ™¯ã€å®šç¾©ã€ç¯„åœç­‰...&#10;&#10;ä¾‹å¦‚ï¼š&#10;- è¨è«–ç¯„åœï¼šåƒ…é™ä¸€èˆ¬æ€§å·¥ä½œï¼Œä¸åŒ…å«å‰µæ„æ€§å·¥ä½œ&#10;- æ™‚é–“ç¯„åœï¼šæœªä¾†10å¹´å…§&#10;- åƒè€ƒè³‡æ–™ï¼šå¯å¼•ç”¨ç›¸é—œç ”ç©¶å ±å‘Š"></textarea>
                            <div class="form-text">
                                <i class="fas fa-lightbulb text-warning"></i>
                                æ¸…æ¥šçš„è­°é¡Œèªªæ˜æœ‰åŠ©æ–¼æå‡è¾¯è«–å“è³ª
                            </div>
                            <div class="character-count mt-1">
                                <small class="text-muted">
                                    <span id="descCount">0</span>/1000 å­—
                                </small>
                            </div>
                        </div>
                        
                        <!-- åˆ†é¡èˆ‡ç«‹å ´ -->
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <label for="debateCategory" class="form-label fw-bold">
                                    ä¸»é¡Œåˆ†é¡ <span class="text-danger">*</span>
                                </label>
                                <select class="form-select" id="debateCategory" name="category" required>
                                    <option value="">è«‹é¸æ“‡åˆ†é¡</option>
                                    <option value="ç§‘æŠ€">ğŸ”¬ ç§‘æŠ€å‰µæ–°</option>
                                    <option value="ç¤¾æœƒ">ğŸ›ï¸ ç¤¾æœƒè­°é¡Œ</option>
                                    <option value="ç’°å¢ƒ">ğŸŒ ç’°å¢ƒæ°¸çºŒ</option>
                                    <option value="æ”¿æ²»">âš–ï¸ æ”¿æ²»åˆ¶åº¦</option>
                                    <option value="æ•™è‚²">ğŸ“š æ•™è‚²å­¸ç¿’</option>
                                    <option value="ç¶“æ¿Ÿ">ğŸ’° ç¶“æ¿Ÿç™¼å±•</option>
                                    <option value="æ–‡åŒ–">ğŸ­ æ–‡åŒ–è—è¡“</option>
                                    <option value="å¥åº·">ğŸ¥ å¥åº·é†«ç™‚</option>
                                    <option value="å…¶ä»–">ğŸ“‹ å…¶ä»–è­°é¡Œ</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="myPosition" class="form-label fw-bold">
                                    æˆ‘çš„ç«‹å ´ <span class="text-danger">*</span>
                                </label>
                                <select class="form-select" id="myPosition" name="position" required>
                                    <option value="">è«‹é¸æ“‡ç«‹å ´</option>
                                    <option value="pro">ğŸ‘ æ­£æ–¹ï¼ˆæ”¯æŒè©²è­°é¡Œï¼‰</option>
                                    <option value="con">ğŸ‘ åæ–¹ï¼ˆåå°è©²è­°é¡Œï¼‰</option>
                                </select>
                                <div class="form-text">
                                    <i class="fas fa-balance-scale text-info"></i>
                                    é¸æ“‡å¾Œå°‡ç­‰å¾…æŒç›¸åç«‹å ´çš„å°æ‰‹
                                </div>
                            </div>
                        </div>

                        <!-- è¾¯è«–è¨­å®š -->
                        <div class="card mb-4">
                            <div class="card-header bg-light">
                                <h6 class="mb-0"><i class="fas fa-cog me-2"></i>è¾¯è«–è¨­å®š</h6>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="timeLimit" class="form-label">æ¯è¼ªç™¼è¨€æ™‚é™</label>
                                        <select class="form-select" id="timeLimit" name="time_limit">
                                            <option value="24" selected>24å°æ™‚ï¼ˆæ¨è–¦ï¼‰</option>
                                            <option value="12">12å°æ™‚</option>
                                            <option value="6">6å°æ™‚ï¼ˆå¿«ç¯€å¥ï¼‰</option>
                                            <option value="3">3å°æ™‚ï¼ˆæ¥µé€Ÿè¾¯è«–ï¼‰</option>
                                        </select>
                                        <div class="form-text">è¶…æ™‚å°‡è¢«è¦–ç‚ºæ£„æ¬Š</div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="levelLimit" class="form-label">åƒèˆ‡è€…ç­‰ç´šé™åˆ¶</label>
                                        <select class="form-select" id="levelLimit" name="level_limit">
                                            <option value="" selected>ä¸é™åˆ¶ï¼ˆæ¨è–¦ï¼‰</option>
                                            <option value="beginner">æ–°æ‰‹å‹å–„ (Lv.1-5)</option>
                                            <option value="intermediate">é€²éšè¾¯æ‰‹ (Lv.6-15)</option>
                                            <option value="advanced">å°ˆå®¶ç´šåˆ¥ (Lv.16+)</option>
                                        </select>
                                    </div>
                                </div>

                                <!-- è¾¯è«–è¦å‰‡ -->
                                <div class="mb-3">
                                    <label class="form-label fw-bold">è¾¯è«–è¦å‰‡</label>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" 
                                               id="needSources" name="need_sources" checked>
                                        <label class="form-check-label" for="needSources">
                                            <strong>å¼·åˆ¶æä¾›è³‡æ–™ä¾†æº</strong>
                                            <div class="text-muted small">æ‰€æœ‰è«–è¿°å¿…é ˆé™„ä¸Šå¯ä¿¡ä¾†æºé€£çµ</div>
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" 
                                               id="allowAudience" name="allow_audience" checked>
                                        <label class="form-check-label" for="allowAudience">
                                            <strong>å…è¨±è§€çœ¾è©•è«–</strong>
                                            <div class="text-muted small">è§€çœ¾å¯ä»¥å°è¾¯è«–é€²è¡Œè©•è«–ï¼Œä½†ä¸å½±éŸ¿çµæœ</div>
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" 
                                               id="enableJudging" name="enable_judging" checked>
                                        <label class="form-check-label" for="enableJudging">
                                            <strong>å•Ÿç”¨è©•å¯©åˆ¶åº¦</strong>
                                            <div class="text-muted small">ç”±è³‡æ·±ç”¨æˆ¶è©•åˆ¤è¾¯è«–å‹è² </div>
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- é æœŸæ•ˆç›Š -->
                        <div class="alert alert-info">
                            <h6 class="alert-heading">
                                <i class="fas fa-star me-2"></i>ç™¼èµ·è¾¯è«–çš„å¥½è™•
                            </h6>
                            <ul class="mb-0">
                                <li>ç²å¾—è¾¯è«–ç¶“é©—å€¼ï¼Œæå‡ç­‰ç´š</li>
                                <li>åŸ¹é¤Šæ‰¹åˆ¤æ€è€ƒèˆ‡è«–è¿°èƒ½åŠ›</li>
                                <li>èˆ‡ä¸åŒè§€é»çš„äººé€²è¡Œç†æ€§äº¤æµ</li>
                                <li>å»ºç«‹å€‹äººè¾¯è«–è²è­½</li>
                            </ul>
                        </div>

                        <!-- æäº¤æŒ‰éˆ• -->
                        <div class="d-grid gap-3">
                            <button type="submit" class="btn btn-success btn-lg" id="submitBtn">
                                <i class="fas fa-rocket me-2"></i>ç™¼èµ·è¾¯è«–
                            </button>
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-outline-secondary flex-fill" 
                                        onclick="saveDraft()">
                                    <i class="fas fa-save me-2"></i>å„²å­˜è‰ç¨¿
                                </button>
                                <a href="{{ url_for('main.debate_board') }}" 
                                   class="btn btn-outline-primary flex-fill">
                                    <i class="fas fa-arrow-left me-2"></i>è¿”å›çœ‹æ¿
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- è¾¯è«–æŠ€å·§æç¤º -->
            <div class="card mt-4 border-0 bg-light">
                <div class="card-body">
                    <h6 class="card-title">
                        <i class="fas fa-graduation-cap text-primary me-2"></i>è¾¯è«–æŠ€å·§å°è²¼å£«
                    </h6>
                    <div class="row">
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>ä¸»é¡Œè¦å…·é«”æ˜ç¢º</li>
                                <li><i class="fas fa-check text-success me-2"></i>æä¾›å……åˆ†èƒŒæ™¯è³‡è¨Š</li>
                                <li><i class="fas fa-check text-success me-2"></i>ä¿æŒå®¢è§€ä¸­ç«‹æ…‹åº¦</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <ul class="list-unstyled">
                                <li><i class="fas fa-check text-success me-2"></i>æº–å‚™å¯ä¿¡è³‡æ–™ä¾†æº</li>
                                <li><i class="fas fa-check text-success me-2"></i>å°Šé‡å°æ‰‹è§€é»</li>
                                <li><i class="fas fa-check text-success me-2"></i>é‚è¼¯æ¸…æ™°æœ‰æ¢ç†</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.hero-icon {
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% {
        transform: scale(1);
    }
    50% {
        transform: scale(1.05);
    }
    100% {
        transform: scale(1);
    }
}

.card {
    border-radius: 15px;
}

.form-control:focus, .form-select:focus {
    border-color: #2c5aa0;
    box-shadow: 0 0 0 0.2rem rgba(44, 90, 160, 0.25);
}

.character-count {
    text-align: right;
}

.form-check-input:checked {
    background-color: #2c5aa0;
    border-color: #2c5aa0;
}

#submitBtn {
    background: linear-gradient(45deg, #28a745, #20c997);
    border: none;
    transition: all 0.3s ease;
}

#submitBtn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
}
</style>

<script>
// å­—æ•¸çµ±è¨ˆ
document.getElementById('debateTitle').addEventListener('input', function() {
    const count = this.value.length;
    document.getElementById('titleCount').textContent = count;
    
    if (count > 180) {
        document.getElementById('titleCount').parentElement.classList.add('text-warning');
    } else if (count > 200) {
        document.getElementById('titleCount').parentElement.classList.add('text-danger');
    } else {
        document.getElementById('titleCount').parentElement.classList.remove('text-warning', 'text-danger');
    }
});

document.getElementById('debateDescription').addEventListener('input', function() {
    const count = this.value.length;
    document.getElementById('descCount').textContent = count;
    
    if (count > 800) {
        document.getElementById('descCount').parentElement.classList.add('text-warning');
    } else if (count > 1000) {
        document.getElementById('descCount').parentElement.classList.add('text-danger');
    } else {
        document.getElementById('descCount').parentElement.classList.remove('text-warning', 'text-danger');
    }
});

// è¡¨å–®é©—è­‰
document.getElementById('debateForm').addEventListener('submit', function(e) {
    const title = document.getElementById('debateTitle').value.trim();
    const category = document.getElementById('debateCategory').value;
    const position = document.getElementById('myPosition').value;
    
    if (!title) {
        alert('è«‹è¼¸å…¥è¾¯è«–ä¸»é¡Œ');
        e.preventDefault();
        return false;
    }
    
    if (title.length < 10) {
        alert('è¾¯è«–ä¸»é¡Œè‡³å°‘éœ€è¦10å€‹å­—å…ƒ');
        e.preventDefault();
        return false;
    }
    
    if (!category) {
        alert('è«‹é¸æ“‡ä¸»é¡Œåˆ†é¡');
        e.preventDefault();
        return false;
    }
    
    if (!position) {
        alert('è«‹é¸æ“‡ä½ çš„ç«‹å ´');
        e.preventDefault();
        return false;
    }
    
    // é¡¯ç¤ºæäº¤ä¸­ç‹€æ…‹
    const submitBtn = document.getElementById('submitBtn');
    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>ç™¼èµ·ä¸­...';
    submitBtn.disabled = true;
});

// å„²å­˜è‰ç¨¿åŠŸèƒ½
function saveDraft() {
    const formData = {
        title: document.getElementById('debateTitle').value,
        description: document.getElementById('debateDescription').value,
        category: document.getElementById('debateCategory').value,
        position: document.getElementById('myPosition').value,
        time_limit: document.getElementById('timeLimit').value,
        level_limit: document.getElementById('levelLimit').value
    };
    
    localStorage.setItem('debate_draft', JSON.stringify(formData));
    alert('è‰ç¨¿å·²å„²å­˜ï¼');
}

// è¼‰å…¥è‰ç¨¿
window.addEventListener('load', function() {
    const draft = localStorage.getItem('debate_draft');
    if (draft) {
        const data = JSON.parse(draft);
        
        if (confirm('ç™¼ç¾å·²å„²å­˜çš„è‰ç¨¿ï¼Œæ˜¯å¦è¦è¼‰å…¥ï¼Ÿ')) {
            document.getElementById('debateTitle').value = data.title || '';
            document.getElementById('debateDescription').value = data.description || '';
            document.getElementById('debateCategory').value = data.category || '';
            document.getElementById('myPosition').value = data.position || '';
            document.getElementById('timeLimit').value = data.time_limit || '24';
            document.getElementById('levelLimit').value = data.level_limit || '';
            
            // è§¸ç™¼å­—æ•¸çµ±è¨ˆ
            document.getElementById('debateTitle').dispatchEvent(new Event('input'));
            document.getElementById('debateDescription').dispatchEvent(new Event('input'));
        }
    }
});

// è¡¨å–®æäº¤æˆåŠŸå¾Œæ¸…é™¤è‰ç¨¿
window.addEventListener('beforeunload', function() {
    const form = document.getElementById('debateForm');
    if (form.checkValidity()) {
        localStorage.removeItem('debate_draft');
    }
});
</script>
{% endblock %}